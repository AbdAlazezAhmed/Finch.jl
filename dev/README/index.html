<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Finch.jl: Simplifying Sparse and Structured Array Programming · Finch.jl</title><meta name="title" content="Finch.jl: Simplifying Sparse and Structured Array Programming · Finch.jl"/><meta property="og:title" content="Finch.jl: Simplifying Sparse and Structured Array Programming · Finch.jl"/><meta property="twitter:title" content="Finch.jl: Simplifying Sparse and Structured Array Programming · Finch.jl"/><meta name="description" content="Documentation for Finch.jl."/><meta property="og:description" content="Documentation for Finch.jl."/><meta property="twitter:description" content="Documentation for Finch.jl."/><meta property="og:url" content="https://willow-ahrens.github.io/Finch.jl/README/"/><meta property="twitter:url" content="https://willow-ahrens.github.io/Finch.jl/README/"/><link rel="canonical" href="https://willow-ahrens.github.io/Finch.jl/README/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Finch.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Finch.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../usage/">Usage</a></li><li><a class="tocitem" href="../semantics/">Semantics</a></li><li><a class="tocitem" href="../fibers/">Array Formats</a></li><li><a class="tocitem" href="../algebra/">Custom Functions</a></li><li><a class="tocitem" href="../fileio/">Tensor File I/O</a></li><li><a class="tocitem" href="../interop/">C, C++, ...</a></li><li><a class="tocitem" href="../performance/">Performance Tips</a></li><li><a class="tocitem" href="../internals/">Internals</a></li><li><a class="tocitem" href="../directory_structure/">Directory Structure</a></li><li><a class="tocitem" href="../CONTRIBUTING/">Contributing</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../benchmark/">Benchmarking</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Finch.jl: Simplifying Sparse and Structured Array Programming</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Finch.jl: Simplifying Sparse and Structured Array Programming</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/willow-ahrens/Finch.jl/blob/main/README.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Finch.jl:-Simplifying-Sparse-and-Structured-Array-Programming"><a class="docs-heading-anchor" href="#Finch.jl:-Simplifying-Sparse-and-Structured-Array-Programming">Finch.jl: Simplifying Sparse and Structured Array Programming</a><a id="Finch.jl:-Simplifying-Sparse-and-Structured-Array-Programming-1"></a><a class="docs-heading-anchor-permalink" href="#Finch.jl:-Simplifying-Sparse-and-Structured-Array-Programming" title="Permalink"></a></h1><p>[docs]:https://willow-ahrens.github.io/Finch.jl/stable [ddocs]:https://willow-ahrens.github.io/Finch.jl/dev [ci]:https://github.com/willow-ahrens/Finch.jl/actions/workflows/CI.yml?query=branch%3Amain [cov]:https://codecov.io/gh/willow-ahrens/Finch.jl [example]:https://github.com/willow-ahrens/Finch.jl/tree/main/docs/examples</p><p>[docs<em>ico]:https://img.shields.io/badge/docs-stable-blue.svg [ddocs</em>ico]:https://img.shields.io/badge/docs-dev-blue.svg [ci<em>ico]:https://github.com/willow-ahrens/Finch.jl/actions/workflows/CI.yml/badge.svg?branch=main [cov</em>ico]:https://codecov.io/gh/willow-ahrens/Finch.jl/branch/main/graph/badge.svg [example_ico]:https://img.shields.io/badge/examples-docs%2Fexamples-blue.svg</p><table><tr><th style="text-align: center"><strong>Documentation</strong></th><th style="text-align: center"><strong>Build Status</strong></th><th style="text-align: center"><strong>Examples</strong></th></tr><tr><td style="text-align: center">[![][docs<em>ico]][docs] [![][ddocs</em>ico]][ddocs]</td><td style="text-align: center">[![][ci<em>ico]][ci] [![][cov</em>ico]][cov]</td><td style="text-align: center">[![][example_ico]][example]</td></tr></table><p>Finch is a cutting-edge Julia-to-Julia compiler specially designed for optimizing loop nests over sparse or structured multidimensional arrays. Finch empowers users to write conventional <code>for</code> loops which the compiler transforms behind-the-scenes into their sparse counterparts.</p><h2 id="Key-Features"><a class="docs-heading-anchor" href="#Key-Features">Key Features</a><a id="Key-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Features" title="Permalink"></a></h2><ul><li><strong>Ease of Writing</strong>: Maintain readable, dense loop structures in your code, and let Finch handle the complexities of sparse data manipulation.</li><li><strong>Smart Compilation</strong>: Finch’s compiler is intuitive and modular, applying optimizations such as constant propagation and term rewriting. Rules like <code>x * 0 =&gt; 0</code> eliminate unnecessary computations in sparse code automatically.</li><li><strong>Wide Format Support</strong>: Seamlessly works with major sparse formats (CSC, CSF, COO, Hash, Bytemap, Dense Triangular) and unique structures like Run Length Encoding or user-defined background (zero) values.</li><li><strong>Enhanced Control Structures</strong>: Introduces flexibility in computations by supporting conditionals, multiple outputs, and even user-defined types and functions.</li></ul><h3 id="Comprebhensive-Sparse-Formats"><a class="docs-heading-anchor" href="#Comprebhensive-Sparse-Formats">Comprebhensive Sparse Formats</a><a id="Comprebhensive-Sparse-Formats-1"></a><a class="docs-heading-anchor-permalink" href="#Comprebhensive-Sparse-Formats" title="Permalink"></a></h3><p>Finch supports a wide variety of array structure beyond sparsity. Whether you&#39;re dealing with <a href="https://en.wikipedia.org/wiki/GraphBLAS">custom background (zero) values</a>, <a href="https://en.wikipedia.org/wiki/Run-length_encoding">run-length encoding</a>, or matrices with <a href="https://en.wikipedia.org/wiki/Sparse_matrix#Special_structure">special structures</a> like banded or triangular matrices, Finch’s compiler can understand and optimize various data patterns and computational rules to adapt to the structure of data.</p><h3 id="Supported-Syntax-and-Structures"><a class="docs-heading-anchor" href="#Supported-Syntax-and-Structures">Supported Syntax and Structures</a><a id="Supported-Syntax-and-Structures-1"></a><a class="docs-heading-anchor-permalink" href="#Supported-Syntax-and-Structures" title="Permalink"></a></h3><table><tr><th style="text-align: right">Feature/Structure</th><th style="text-align: right">Example Usage</th></tr><tr><td style="text-align: right">Major Sparse Formats and Structured Arrays</td><td style="text-align: right"><code>A = Fiber!(Dense(SparseList(Element(0.0)))</code></td></tr><tr><td style="text-align: right">Background Values Other Than Zero</td><td style="text-align: right"><code>B = Fiber!(SparseList(Element(1.0)))</code></td></tr><tr><td style="text-align: right">Broadcasts and Reductions</td><td style="text-align: right"><code>sum(A .* B)</code></td></tr><tr><td style="text-align: right">Custom Operators</td><td style="text-align: right"><code>x[] &lt;&lt;min&gt;&gt;= y[i] + z[i]</code></td></tr><tr><td style="text-align: right">Multiple Outputs</td><td style="text-align: right"><code>x[] &lt;&lt;min&gt;&gt;= y[i]; z[] &lt;&lt;max&gt;&gt;= y[i]</code></td></tr><tr><td style="text-align: right">Multicore Parallelism</td><td style="text-align: right"><code>for i = parallel(1:100)</code></td></tr><tr><td style="text-align: right">Conditionals</td><td style="text-align: right"><code>if dist[] &lt; best_dist[]</code></td></tr><tr><td style="text-align: right">Affine Indexing (e.g. Convolution)</td><td style="text-align: right"><code>A[i + j]</code></td></tr></table><h2 id="Who-Should-Use-Finch.jl?"><a class="docs-heading-anchor" href="#Who-Should-Use-Finch.jl?">Who Should Use Finch.jl?</a><a id="Who-Should-Use-Finch.jl?-1"></a><a class="docs-heading-anchor-permalink" href="#Who-Should-Use-Finch.jl?" title="Permalink"></a></h2><h3 id="Sparse-Kernel-Developers:"><a class="docs-heading-anchor" href="#Sparse-Kernel-Developers:">Sparse Kernel Developers:</a><a id="Sparse-Kernel-Developers:-1"></a><a class="docs-heading-anchor-permalink" href="#Sparse-Kernel-Developers:" title="Permalink"></a></h3><p>If you often find yourself needing to write sparse code for unusual or specific problems that don&#39;t have existing library solutions, Finch.jl is for you. Finch lets you outline a high-level plan and then compiles it into efficient code, making your task much easier.</p><h3 id="Custom-Array-Enthusiasts:"><a class="docs-heading-anchor" href="#Custom-Array-Enthusiasts:">Custom Array Enthusiasts:</a><a id="Custom-Array-Enthusiasts:-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Array-Enthusiasts:" title="Permalink"></a></h3><p>If you&#39;re trying to implement a new array type (e.g. blocked, padded, ragged, etc...), Finch can help. You can use the Finch tensor interface to describe the structure of the array, and Finch will take care of creating a full implementation. This includes functionalities like getindex, map, reduce, and more, all of which will work inside other Finch kernels.</p><h3 id="Users-Seeking-Convenience-for-Sparse-Operations:"><a class="docs-heading-anchor" href="#Users-Seeking-Convenience-for-Sparse-Operations:">Users Seeking Convenience for Sparse Operations:</a><a id="Users-Seeking-Convenience-for-Sparse-Operations:-1"></a><a class="docs-heading-anchor-permalink" href="#Users-Seeking-Convenience-for-Sparse-Operations:" title="Permalink"></a></h3><p>If you need flexible and convenient support for sparse array operations, Finch.jl may be a good choice. The formats in Finch can adapt to many use cases, and it supports high-level commands like broadcast and reduce. By understanding how Finch generates implementations, you can get decent performance for a variety of problems.</p><p>Note: Finch is currently optimized for sparse code and does not implement traditional dense optimizations. We are currently adding these features, but if you need dense performance, you may want to look at <a href="https://github.com/JuliaSIMD/LoopVectorization.jl">LoopVectorization.jl</a> <a href="https://github.com/mcabbott/Tullio.jl">Tullio.jl</a> or <a href="https://github.com/JuliaGPU">JuliaGPU</a></p><h2 id="Quick-Start:-Examples"><a class="docs-heading-anchor" href="#Quick-Start:-Examples">Quick Start: Examples</a><a id="Quick-Start:-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Start:-Examples" title="Permalink"></a></h2><h3 id="Calculating-Sparse-Vector-Statistics"><a class="docs-heading-anchor" href="#Calculating-Sparse-Vector-Statistics">Calculating Sparse Vector Statistics</a><a id="Calculating-Sparse-Vector-Statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-Sparse-Vector-Statistics" title="Permalink"></a></h3><p>Below is a Julia program using Finch to compute the minimum, maximum, sum, and variance of a sparse vector. This program efficiently reads the vector once, focusing only on nonzero values.</p><pre><code class="language-julia hljs">using Finch

X = Fiber!(SparseList(Element(0.0)), fsprand((10,), 0.5))
x_min = Scalar(Inf)
x_max = Scalar(-Inf)
x_sum = Scalar(0.0)
x_var = Scalar(0.0)

@finch begin
    for i = _
        let x = X[i]
            x_min[] &lt;&lt;min&gt;&gt;= x
            x_max[] &lt;&lt;max&gt;&gt;= x
            x_sum[] += x
            x_var[] += x * x
        end
    end
end;</code></pre><h3 id="Sparse-Matrix-Vector-Multiplication"><a class="docs-heading-anchor" href="#Sparse-Matrix-Vector-Multiplication">Sparse Matrix-Vector Multiplication</a><a id="Sparse-Matrix-Vector-Multiplication-1"></a><a class="docs-heading-anchor-permalink" href="#Sparse-Matrix-Vector-Multiplication" title="Permalink"></a></h3><p>As a more traditional example, what follows is a sparse matrix-vector multiplication using a column-major approach.</p><pre><code class="language-julia hljs">x = Fiber!(Dense(Element(0.0)), rand(42));
A = Fiber!(Dense(SparseList(Element(0.0))), fsprand((42, 42), 0.1));
y = Fiber!(Dense(Element(0.0)));

@finch begin
    y .= 0
    for j=_, i=_
        y[i] += A[i, j] * x[j]
    end
end</code></pre><h1 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h1><p>At the <a href="https://julialang.org/downloads/">Julia</a> REPL, install the latest stable version by running:</p><pre><code class="language-julia hljs">julia&gt; using Pkg; Pkg.add(&quot;Finch&quot;)</code></pre><h2 id="Learn-More"><a class="docs-heading-anchor" href="#Learn-More">Learn More</a><a id="Learn-More-1"></a><a class="docs-heading-anchor-permalink" href="#Learn-More" title="Permalink"></a></h2><p>At it&#39;s heart, Finch is powered by a new domain specific language for coiteration, breaking structured iterators into control flow units we call <strong>Looplets</strong>. Looplets are lowered progressively with several stages for rewriting and simplification.</p><p>The technologies enabling Finch are described in our <a href="https://doi.org/10.1145/3579990.3580020">manuscript</a>.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Thursday 2 November 2023 07:33">Thursday 2 November 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
